<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>crc/crc-responsibility.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ClassDeclarationCrcClass.html">ClassDeclarationCrcClass</a><ul class='members'><li data-type='member'><a href="ClassDeclarationCrcClass.html#.descriptor">descriptor</a></li></ul><ul class='methods'><li data-type='method'><a href="ClassDeclarationCrcClass.html#.factory">factory</a></li></ul></li><li><a href="CrcClass.html">CrcClass</a><ul class='methods'><li data-type='method'><a href="CrcClass.html#.factory">factory</a></li></ul></li><li><a href="CrcModel.html">CrcModel</a></li><li><a href="CrcResponsibility.html">CrcResponsibility</a><ul class='methods'><li data-type='method'><a href="CrcResponsibility.html#.create">create</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-eslint-plugin-crc_crc.html">eslint-plugin-crc/crc</a><ul class='members'><li data-type='member'><a href="module-eslint-plugin-crc_crc.html#.CrcClass">CrcClass</a></li><li data-type='member'><a href="module-eslint-plugin-crc_crc.html#.CrcModel">CrcModel</a></li></ul></li><li><a href="module-eslint-plugin-crc_formatters_crc.html">eslint-plugin-crc/formatters/crc</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">crc/crc-responsibility.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const doctrine = require("doctrine");
const bunyan = require("bunyan");
const { find, get } = require("lodash");

/**
 * @private
 */
const logger = bunyan.createLogger({
  name: "[eslint-plugin-crc-logger]",
  level: "error"
});
/**
 * Remove all comment delimiters.
 *
 * @param {ASTNode} node - An ESLint representation of ECMAScript programming
 * elements.
 * @param {Context} context - A summary object with `SourceCode` and file info.
 * @returns {string} JSDoc tags associated with a prototypal `object`, stripped
 * of comment delimiters.
 * @private
 */
const unwrapComments = (node, context) => {
  let comments = [];
  try {
    comments = node.leadingComments ||
      context.getCommentsBefore(node);
  } catch (typeError) {
    logger.error(`${typeError}.\n\nPlease configure your parser settings with "attachComment: true".`);
  }

  const unwrappedComments = comments.reduce((accumulator, comment) => (
    accumulator + comment.value
      .replace(/^\s*\//gm, "")
      .replace(/^\s*\**/gm, "")
      .replace(/^\s+/gm, "")
      .trim()
  ), "");
  return unwrappedComments;
};

/**
 * Iterates over elements of a `doctrine` AST, returning the first element
 * predicate returns truthy for.
 *
 * @param {AST} ast - A {@link https://github.com/eslint/doctrine doctrine}
 * representation of JSDoc tags.
 * @returns {string} The description of the `object`.
 * @private
 */
function getResponsibility (ast) {
  const descTags = ["classdesc", "desc", "description", "summary"];
  let responsibility = get(ast, "description");
  if (responsibility) {
    return responsibility.replace(/\n/gm, "");
  }
  return get(find(ast.tags, (tag) => descTags.includes(tag.title)),
    "description");
}

/**
 * Evaluates objects for declarations of intent, i.e., responsibility.
 *
 */
class CrcResponsibility {
  /**
   * A factory method that generates a
   * {@link https://github.com/eslint/doctrine doctrine} AST and
   * responsibility string (if found).
   *
   * @param {ASTNode} node - An ESLint representation of ECMAScript programming
   * elements.
   * @param {Context} context - A summary object with `SourceCode` and file info.
   * @returns {object} `doctrine` annotations and a `responsibility`
   * statement (if found).
   */
  static create (node, context) {
    const ast = doctrine.parse(unwrapComments(node, context), {
      recoverable: true,
      sloppy: true
    });
    const responsibility = getResponsibility(ast);
    return {
      ast,
      responsibility
    };
  }
}

module.exports = CrcResponsibility;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Dec 08 2017 02:18:00 GMT-0600 (CST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
